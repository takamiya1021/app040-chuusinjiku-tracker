# 2バージョン対応の要約

**作成日**: 2025-10-19
**対象**: 中心軸トラッカー プロジェクト

---

## 概要

自分用（プライベート版）と公開用（パブリック版）の2つのデータセットを用意し、データファイルの入れ替えだけで切り替え可能な設計。

---

## 2バージョンの違い

| 項目 | プライベート版 | パブリック版 |
|------|--------------|------------|
| **ファイル名** | `articles-private.json` | `articles-public.json` |
| **本文内容** | 元メール本文そのまま | 著作権対策済み要約版 |
| **文字数** | 制限なし | 1,000〜3,000文字 |
| **処理** | タイトル・カテゴリー生成のみ | 完全要約・再構成 |
| **用途** | あおいさん個人利用 | 一般公開 |
| **デプロイ** | ローカル環境のみ | Vercel等の公開環境 |
| **著作権** | 問題なし（私的利用） | 対策済み（一般表現に変換） |

---

## データ構造（共通）

両バージョンで同一の構造を使用：

```typescript
interface Article {
  id: string;                    // UUID（両バージョンで同一IDを使用）
  title: string;                 // タイトル（30文字以内）
  content: string;               // 本文（唯一の違い）
  category: string;              // カテゴリー名
  date: string;                  // 記事日付
  originalDate: string;          // 元メール日付
  createdAt: string;             // 作成日時
  tags?: string[];               // タグ
}
```

**重要**: 同じ記事セットを異なる表現で保持するため、IDは両バージョンで一致させる。

---

## 切り替え方法

### 方法1: ビルドスクリプト（推奨）

`package.json`に以下を追加：

```json
{
  "scripts": {
    "dev": "next dev",
    "build:private": "cp data/articles-private.json public/articles.json && next build",
    "build:public": "cp data/articles-public.json public/articles.json && next build",
    "build": "npm run build:public"
  }
}
```

**使用例**:
```bash
# プライベート版で開発
npm run dev  # 事前に articles-private.json を public/articles.json にコピー

# パブリック版ビルド（本番公開用）
npm run build:public

# プライベート版ビルド（ローカル確認用）
npm run build:private
```

### 方法2: 手動コピー

```bash
# プライベート版
cp data/articles-private.json public/articles.json

# パブリック版
cp data/articles-public.json public/articles.json
```

---

## データ作成フロー

### Phase 2A: プライベート版作成（30分〜1時間）

1. **プロンプト**（Gemini 2.5 Flash）:
   ```
   以下のメール本文を分析し、タイトルとカテゴリーのみ提案してください。
   本文はそのまま使用するため、要約は不要です。

   【タスク】
   - タイトル: 30文字以内で内容を表すタイトル
   - カテゴリー: 1つ選択（自己受容、目標設定、習慣形成など）

   【出力形式】
   タイトル: [タイトル]
   カテゴリー: [カテゴリー名]

   [メール本文]
   ```

2. **処理**: 元本文をそのまま保持、タイトル・カテゴリーのみAI生成

3. **保存**: `data/articles-private.json`

### Phase 2B: パブリック版作成（2〜3時間）

1. **プロンプト**（Gemini 2.5 Flash）:
   ```
   以下のメール本文を、メンタルを整える読み物として要約してください。

   【要約条件】
   - 文字数: 1000〜3000文字
   - 心に響くメッセージ・本質的な内容を保持
   - 読みやすく、自然な文章構成

   【著作権対策（必須）】
   - 元の表現・言い回しをそのまま使用しない
   - 固有の言い回しや独自の表現を避ける
   - 本質的なメッセージを抽出し、一般的でわかりやすい表現に再構成
   - 引用ではなく、内容を理解した上での「再構成」として作成
   - オリジナルとは異なる文章構成・言い回しを使用

   【出力形式】
   タイトル: [30文字以内の魅力的なタイトル]
   カテゴリー: [カテゴリー名]
   本文: [要約された本文]

   [メール本文]
   ```

2. **処理**: 完全要約・再構成、著作権対策実施

3. **保存**: `data/articles-public.json`

---

## デプロイ戦略

### プライベート版（ローカル環境）

```bash
# 1. プライベート版データを配置
cp data/articles-private.json public/articles.json

# 2. 開発サーバー起動
npm run dev

# ブラウザで http://localhost:3000 にアクセス
```

**重要**: プライベート版は外部公開しない

### パブリック版（公開環境）

```bash
# 1. パブリック版データを配置
cp data/articles-public.json public/articles.json

# 2. ビルド
npm run build:public

# 3. Vercelにデプロイ
vercel --prod
```

---

## 検証項目

### データ品質チェック

- [ ] プライベート版: 元本文が保持されているか
- [ ] パブリック版: 1000〜3000文字範囲に収まっているか
- [ ] 両バージョン: 記事数が一致しているか（同じ記事セット）
- [ ] 両バージョン: 同一IDが使用されているか
- [ ] 両バージョン: 重複記事がないか
- [ ] 両バージョン: カテゴリー分類が完了しているか

### 著作権対策チェック（パブリック版のみ）

- [ ] 元の表現・言い回しと異なるか
- [ ] 一般的でわかりやすい表現になっているか
- [ ] 本質的なメッセージは保持されているか
- [ ] ランダムサンプル10件を手動確認

### 動作確認

- [ ] プライベート版: ローカル環境で正常動作
- [ ] パブリック版: ローカル環境で正常動作
- [ ] パブリック版: 本番環境で正常動作
- [ ] データファイル切り替えが正常に動作

---

## ファイル構成

```
app040-chuusinjiku-tracker/
├── data/
│   ├── raw_emails.json           # 元メールデータ（一時）
│   ├── articles-private.json     # プライベート版
│   └── articles-public.json      # パブリック版
│
├── public/
│   └── articles.json             # 実行時使用（切り替え可能）
│
└── ...
```

---

## まとめ

### メリット

1. **コードの一貫性**: アプリコードは完全に同一
2. **簡単な切り替え**: ファイルコピーだけで切り替え可能
3. **著作権対策**: 公開版は完全に再構成済み
4. **開発効率**: 自分用では元データをそのまま使用可能

### 運用

- **開発時**: プライベート版で快適に開発
- **公開時**: パブリック版で安心して公開
- **切り替え**: npmスクリプト1つで完結

---

**参照ドキュメント**:
- `doc/requirements_v1.0.md` - セクション3.1.1, 3.1.2, 3.1.3
- `doc/gmail_collection_proposal.md` - Phase 3
- `doc/technical_design_v1.0.md` - セクション2.1, 11.1
- `doc/implementation_plan_v1.0.md` - Phase 2
